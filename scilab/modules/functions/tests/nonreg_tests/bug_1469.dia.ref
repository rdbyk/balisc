funcprot(0)
 ans  =
   1.
function foo,endfunction
L=macr2tree(foo);
R1=L(6)==1&size(L)==6;
if ~R1 then bugmes();quit;end
clear foo;
function foo(),endfunction
L=macr2tree(foo);
R3=L(6)==1&size(L)==6;
if ~R3 then bugmes();quit;end
clear foo;
function foo(),a=1,endfunction
L=macr2tree(foo);
R4=L(6)==1&size(L)==6;
if ~R4 then bugmes();quit;end
clear foo;
function foo
endfunction
L=macr2tree(foo);
R5=L(6)==2&size(L)==6;
if ~R5 then bugmes();quit;end
clear foo;
function foo,
endfunction
L=macr2tree(foo);
R6=L(6)==2&size(L)==6;
if ~R6 then bugmes();quit;end
clear foo;
function foo//ZZZZ
endfunction
L=macr2tree(foo);
R7=L(6)==2&size(L)==6;
if ~R7 then bugmes();quit;end
clear foo;
function foo,//ZZZZ
endfunction
L=macr2tree(foo);
R8=L(6)==2&size(L)==6;
if ~R8 then bugmes();quit;end
clear foo;
function foo
    //ZZZZ
endfunction
L=macr2tree(foo);
R9=L(6)==3&size(L)==6;
if ~R9 then bugmes();quit;end
clear foo;
function foo,//ZZZZ
    a=1
endfunction
L=macr2tree(foo);
R10=L(6)==3&size(L)==6;
if ~R10 then bugmes();quit;end
clear foo;
function loc=foo,[l,w]=where(),loc=l(1),endfunction
R11= and(foo()==1);
if ~R11 then bugmes();quit;end
clear foo;
function loc=foo,//ZZZZ
    [l,w]=where(),loc=l(1)
endfunction
R12= and(foo()==2);
if ~R12 then bugmes();quit;end
clear foo;
function loc=foo
    //ZZZZ
    [l,w]=where(),loc=l(1)
endfunction
R13= and(foo()==3);
if ~R13 then bugmes();quit;end
clear foo;
function loc=foo1()
    [l,w]=where(),loc=l(1)
    function loc=foo3(loc)
        [l,w]=where(),loc=[loc,l(1:2)']
    endfunction
    [l,w]=where(),loc=[loc,l(1)]
    loc=foo3(loc)
endfunction
R14= and(foo1()==[2,6,2,7]);
if ~R14 then bugmes();quit;end
clear foo1;
function loc=foo1()//ZZZZZZZ
    [l,w]=where(),loc=l(1)
    function loc=foo3(loc)
        [l,w]=where(),loc=[loc,l(1:2)']
    endfunction
    [l,w]=where(),loc=[loc,l(1)]
    loc=foo3(loc)
endfunction
L=macr2tree(foo1);
R15=and(foo1()==[2,6,2,7])&(L(6)==8);
if ~R15 then bugmes();quit;end
clear foo1;
function loc=foo1()
    //ZZZZZZZ
    [l,w]=where(),loc=l(1)
    function loc=foo3(loc)
        [l,w]=where(),loc=[loc,l(1:2)']
    endfunction
    [l,w]=where(),loc=[loc,l(1)]
    loc=foo3(loc)
endfunction
L=macr2tree(foo1);
R16=and(foo1()==[3,7,2,8])&(L(6)==9);
if ~R16 then bugmes();quit;end
clear foo1;
deff("y=foo(a,b,c)","y=a+b+c");
R17=foo("aaa","bbb","cc")=="aaabbbcc";
if ~R17 then bugmes();quit;end
clear foo
deff("y=foo(a,b,c)",["","y=a+b+c"]);
R18=foo("aaa","bbb","cc")=="aaabbbcc";
if ~R18 then bugmes();quit;end
clear foo
z=0;R20=%t;
for k=1:2
    function y=foo()
        y=k
    endfunction
    L=macr2tree(foo);
    R20=R20&(L(6)==3);
    z=z+foo();
end
R20=R20&z==3;
if ~R20 then bugmes();quit;end
t=["function foo,//ZZZZ"
"  a=1"
"endfunction"];
mputl(t,TMPDIR+"/foo.sci");
warning("off");
exec(TMPDIR+"/foo.sci")
function foo,//ZZZZ
  a=1
endfunction
warning("on");
L=macr2tree(foo);
R21=L(6)==3&size(L)==6;
if ~R21 then bugmes();quit;end
clear foo;
t=["function foo"
"//ZZZZ"
"  a=1"
"endfunction"];
mputl(t,TMPDIR+"/foo.sci");
exec(TMPDIR+"/foo.sci")
function foo
//ZZZZ
  a=1
endfunction
L=macr2tree(foo);
R22=L(6)==4&size(L)==6;
if ~R22 then bugmes();quit;end
clear foo;
function foo()
    function bar()
        a=1
    endfunction
endfunction
t=macr2tree(foo);
t=tree2code(t);
if size(t,1)<>5 then bugmes();quit;end
clear foo
function foo()
    function bar()
        a=1
    endfunction
endfunction
t1=macr2tree(foo);
t1=tree2code(t1);
if or(t<>t1) then bugmes();quit;end
function test;endfunction
L=macr2tree(test);
if size(L)<>6 then bugmes();quit;end
if L(6)<>1 then bugmes();quit;end
